\documentclass[preprint]{sigplanconf}

% The following \documentclass options may be useful:

% preprint      Remove this option only once the paper is in final form.
% 10pt          To set in 10-point type instead of 9-point.
% 11pt          To set in 11-point type instead of 9-point.
% authoryear    To obtain author/year citation style instead of numeric.

\usepackage{amsmath}
%\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{bbm}
\usepackage{stmaryrd}
\usepackage{proof}
\usepackage{mathpartir}
\usepackage{mathabx}
\usepackage{listings}
\usepackage{hyperref}
\usepackage{cprotect}

\usepackage{cleveref}
\AtBeginDocument{\renewcommand\ref\cref}
\crefname{figure}{Figure}{Figures}
\crefname{theorem}{Theorem}{Theorems}


\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{remark}[theorem]{Remark}

\input {macros}

\begin{document}

\lstset{language=ML,
        columns=fullflexible,
        basicstyle=\ttfamily,
        tabsize=4,
        escapeinside={"*}{*"},
        literate={|->}{{\ $\mapsto$\ }}1
                 {xhat}{{$\hat{\texttt{x}}$}}1
                 {yhat}{{$\hat{\texttt{y}}$}}1
                 {zhat}{{$\hat{\texttt{z}}$}}1
                 {murec}{{$\mu$}}1
                 {alpha}{{$\alpha$}}1
                 {beta}{{$\beta$}}1
                 {$}{{$\fut$}}1}

\special{papersize=8.5in,11in}
\setlength{\pdfpageheight}{\paperheight}
\setlength{\pdfpagewidth}{\paperwidth}

\conferenceinfo{CONF 'yy}{Month d--d, 20yy, City, ST, Country} 
\copyrightyear{20yy} 
\copyrightdata{978-1-nnnn-nnnn-n/yy/mm} 
\doi{nnnnnnn.nnnnnnn}

% Uncomment one of the following two, if you are not going for the 
% traditional copyright transfer agreement.

%\exclusivelicense                % ACM gets exclusive license to publish, 
                                  % you retain copyright

%\permissiontopublish             % ACM gets nonexclusive license to publish
                                  % (paid open-access papers, 
                                  % short abstracts)

%\titlebanner{banner above paper title}        % These are ignored unless
%\preprintfooter{short description of paper}   % 'preprint' option specified.

\title{Stage-Splitting a Modal Language}

\authorinfo{Nicolas Feltman \and Carlo Angiuli \and Umut Acar \and Kayvon Fatahalian}
           {Carnegie Mellon University}
           {\{nfeltman,cangiuli,umut,kayvonf\}@cs.cmu.edu}

\maketitle

%\begin{abstract}
%\input{abstract}
%\end{abstract}

%\category{CR-number}{subcategory}{third-level}

% general terms are not compulsory anymore, 
% you may leave them out
%\terms
%term1, term2

%\keywords
%keyword1, keyword2

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Introduction}

This document is a tech report on ongoing research into a program transformation
technique which we call {\em stage splitting}, which statically transforms a program written in a multi-stage (modal) language into multiple unstaged (monostage) terms.

The idea of splitting has previously been explored as an optimization technique that improves performance in situations where multi-variate functions are invoked many times, with some inputs being invariant across invocations and others being dynamic (varying across invocations). Prior examples of splitting include the ``data specialization" work of Knoblock and Ruff\,\cite{knoblock96} as well as the compilation of high-level shading languages for computer graphics such as RTSL\,\cite{Proudfoot:2001} and Spark\,\cite{Foley:2011}. In this document we define the splitting transformation for the two-stage language \lang, a typed lambda calculus featuring products, sums, and isorecursive types. 

\begin{itemize}
\item \Cref{sec:semantics} describes \lang\ which serves to unambiguously specify the input to splitting.  The type system of \lang\ is drawn from prior work, but its semantics are uniquely defined in anticipation of splitting.

\item \Cref{sec:splitting} describes the splitting transformation on \lang.  As stated above, splitting accepts terms in \lang\ as input, and converts them to terms in a standard unstaged language.  This section also formally defines the correctness for the splitting transformation.

\item \Cref{sec:examples} gives several examples of how splitting terms in \lang\ can be used
to derive data structures that are communicated between the two unstaged terms, and discusses the effectiveness and limitations of this technique.  Unlike prior work, where the data communicated between the resultant unstaged terms was a basic tuple of values, splitting \lang\ terms can generate non-trivial intermediate structures, such as trees.
\end{itemize}

\input{semantics}
\input{splitting}
\input{algoexamples}

%\appendix
%\section{Appendix Title}
%This is the text of the appendix, if you need one.

%\acks
%Acknowledgments, if needed.

% We recommend abbrvnat bibliography style.

\bibliography{techreport}
\bibliographystyle{abbrvnat}

\end{document}
