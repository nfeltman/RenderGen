%!TEX root = ../paper.tex

\begin{figure*}
\begin{abstrsyn}
\begin{mathpar}
\fbox{Stage \bbonem} 
\and
\infersplitone [unit]			{\spl {\tup{}}{\rmunit}{\tup{\tup{},\tup{}}}{\_.\tup{}}}												{\cdot} \and
%\infersplitone [int]			{\spl {i}{\rm int}{\tup{i,\tup{}};\_.\tup{}}}														{\cdot} \and
\infersplitone [hyp]			{\spl {x}{A}{\tup{x,\tup{}}}{\_.x}}																	{\cdot} \and
\infersplitone [\to I]			{\spl {\lam{x}{e}}{A \to B}{\tup{\lam x c, \tup{}}}{\_.\tup{\lam {\tup{x,l}} r}}}					{\sub [\Gamma,\col x A] {} B} 									\and
\infersplitone [\to E]			{\splitonetall {\app {e_1}{e_2}}{B}{\left(
									\talllet{\tup{y_1,z_1}}{c_1}{
									\talllet{\tup{y_2,z_2}}{c_2}{
									\talllet{\tup{y_3,z_3}}{\app{y_1}{y_2}}{\tup{y_3,\tup{z_1,z_2,z_3}}\ttrpar\ttrpar\ttrpar}}}
									\right)}
									{\tup{l_1,l_2,l_3}.\app{r_1}{\tup{r_2,l_3}}}}													{\sub 1 {A \to B} & \sub 2 A}							\and
\infersplitone [\times I] 	{\splitonetall {\tup{e_1,e_2}}{A\times B}
									{\left(
										\talllet{\tup{y_1,z_1}}{c_1}{
										\talllet{\tup{y_2,z_2}}{c_2}{
										\tup{\tup{y_1, y_2},\tup{z_1, z_2}}\ttrpar\ttrpar}}
									\right)}
									{\tup{l_1,l_2}.\tup{r_1,r_2}}}																				{\sub 1 A & \sub 2 B} \and
\infersplitone [\times E_1]	
	{\spl {\scriptCapp e}{A}{\letin{\tup{y,z}}{c}{\tup{\scriptCapp y,z}}}{l.\scriptCapp r}}								
	{\sub {} {A\times B} 
	& \scriptC \in \{\mathtt{pi1},\mathtt{pi2},\mathtt{inl},\mathtt{inr},\mathtt{roll},\mathtt{unroll}\}} \and
%\infersplitone [\times E_2]	{\spl {\pit~e}{B}{\talllet{\tup{y,z}}{c}{\tup{\pit~y,z}};l.\pit~r}}								{\sub {} {A\times B}} \and
%\infersplitone [let]			{\spl {\letin{x}{e_1}{e_2}}{B}{
%								\begin{array}{l}
%									\left(\talllet{\tup{x,z_1}}{c_1}{
%									\talllet{\tup{y,z_2}}{c_2}{
%									\tup{y, \tup{z_1, z_2}}}}\right);
%									\tup{l_1,l_2}.\letin{x}{r_1}{r_2}
%								\end{array}}}																					{\sub 1 A & \sub [\Gamma,\col{x}{A}] 2 B} 		\and
%\infersplitone [+ I_1]	{\spl {\inl~e}{A+B}{\talllet{\tup{y,z}}{c}{\tup{\inl~y,z}};l.r}}			{\sub {} A}												\and
%\infersplitone [+ I_2]	{\spl {\inr~e}{A+B}{\talllet{\tup{y,z}}{c}{\tup{\inr~y,z}};l.r}}			{\sub {} A}												\and
\infersplitone [+ E]		{\splitonetall {\caseof{e_1}{x_2.e_2}{x_3.e_3}}{C}
								{\left(
								\talllet{\tup{y_1,z_1}}{c_1}{
									\tallcase{y_1}
									{x_2.\letin{\tup{y_2,z_2}}{c_2}{\tup{y_2,\tup{z_1,\inl{z_2}}}}}
									{x_3.\letin{\tup{y_3,z_3}}{c_3}{\tup{y_3,\tup{z_1,\inr{z_3}}}}\ttrpar}
								}\right)}
								{\tup{l_1,l_b}.\letin{z}{r_1}{\caseof{l_b}{l_2.[z/x_2]{r_2}}{l_3.[z/x_3]{r_3}}}
								}}				{\sub 1 {A+B} & \sub [\Gamma,\col{x_2} A] 2 C 	& \sub [\Gamma,\col{x_3} B] 3 C} 	
%
%\infersplitone [\mu I]		{\spl {\roll~e}{\mu\alpha.\tau}{\talllet{\tup{y,z}}{c}{\tup{\roll~y,z}};l.r}}						{\sub {} {[\mu\alpha.\tau/\alpha]\tau}}							\and
%\infersplitone [\mu E]		{\spl {\unroll~e}{[\mu\alpha.\tau/\alpha]\tau}{\talllet{\tup{y,z}}{c}{\tup{\unroll~y,z}};l.r}}	{\sub {} {\mu\alpha.\tau}}										\and
%
%\infersplitone [if]			{\spl {\left( \tallif {e_1}{e_2}{e_3} \right)}{A} 
%								{\begin{array}{l}
%									\left(\talllet{\tup{y_1,z_1}}{c_1}{\tallif {y_1}
%										{\letin{\tup{y_2,z_2}}{c_2}{\tup{y_2, \tup{z_1, \inl~z_2}}}}
%										{\letin{\tup{y_3,z_3}}{c_2}{\tup{y_3, \tup{z_1, \inl~z_3}}}}}
%									\right); \\
%									\tup{l_1,l_b}.\tup{r_1;\caseof{l_b}{l_2.r_2}{l_3.r_3}}
%								\end{array}}}																					{\sub 1 \rmbool & \sub 2 A & \sub 3 A }		\and

%\infersplitone	{\spl {\liftint~e} ? {c;l.r}}											{\sub {} ?}					

\end{mathpar}
\hrule
\begin{mathpar}
\fbox{Stage \bbtwo} 
\and
\infersplittwo [unit]			{\spl {\tup{}} {\rmunit} {\tup{}} {\_}{\tup{}}}												{\cdot} 														\and
%\infersplittwo [int]			{\spl {i}{\rm int}{\tup{};\_}{i}}															{\cdot} 														\and
\infersplittwo [hyp]			{\spl {x}{A}{\tup{}}{\_}{x}}																{\cdot} 														\and
\infersplittwo [\times E_1]		{\spl {\scriptCapp e}{A}{p}{l}{\scriptCapp r}}												{\sub {} {A\times B} 
																															& \scriptC \in \{\mathtt{pi1},\mathtt{pi2},\mathtt{inl},
																															  \mathtt{inr},\mathtt{roll},\mathtt{unroll}\}} 				\and
\infersplittwo [\to I]			{\spl {\lam{x}{e}}{A \to B}{p}{l}{\lam{x}{r}}}												{\sub [\Gamma,\col x A] {} B} 									\and
\infersplittwo [\to E]			{\spl {\app{e_1}{e_2}}{B}{\tup{p_1,p_2}}{\tup{l_1,l_2}}{\app{r_1}{r_2}}}					{\sub 1 {A \to B} & \sub 2 A}									\and
\infersplittwo [\times I]		{\spl {\tup{e_1,e_2}}{A\times B}{\tup{p_1,p_2}}{\tup{l_1,l_2}}{\tup{r_1,r_2}}}				{\sub 1 A & \sub 2 B} 											\and
%\infersplittwo [\times E_2]	{\spl {\pit~e}{B}{p;l}{\pit~r}}																{\sub {} {A\times B}} 											\and
%\infersplittwo [+ I_1]			{\spl {\inl~e}{A+B}{p;l}{\inl~r}}															{\sub {} A}														\and
%\infersplittwo [+ I_1]			{\spl {\inr~e}{A+B}{p;l}{\inr~r}}															{\sub {} A}														\and
%\infersplittwo [\mu I]			{\spl {\roll~e}{\mu\alpha.\tau}{p;l.\roll~r}}												{\sub {} {[\mu\alpha.\tau/\alpha]\tau}}							\and
%\infersplittwo [\mu E]			{\spl {\unroll~e}{[\mu\alpha.\tau/\alpha]\tau}{p;l.\unroll~r}}								{\sub {} {\mu\alpha.\tau}}										\and
\infersplittwo [+ E]			{\spl {\caseof{e_1}{x_2.e_2}{x_3.e_3}}{C}
								{\tup{p_1,p_2,p_3}}{ \tup{l_1,l_2,l_3}}{\caseof{r_1}{x_2.r_2}{x_3.r_3}}}					{\sub 1 {A+B} & \sub [\Gamma,\col{x_2} A] 2 C 
																															& \sub [\Gamma,\col{x_3} B] 3 C} 								
%\infersplittwo [let]			{\spl {\letin{x}{e_1}{e_2}}{B}{\tup{p_1,p_2}, \tup{l_1,l_2}.\letin{x}{r_1}{r_2}}}				{\sub 1 A & \sub [\Gamma,\col{x}{A}] 2 B} 		\and
%\infersplittwo [if]			{\spl {\left(\tallif {e_1}{e_2}{e_3}\right)}{A} 
%								{\tup{p_1,p_2,p_3}}{\tup{l_1,l_2,l_3}.\left(\tallif{r_1}{r_2}{r_2}\right)}}						{\sub 1 \rmbool & \sub 2 A & \sub 3 A }		\and
\end{mathpar} 
\hrule
\begin{mathpar}
\fbox{Staging features}
\and
\infersplittwo [\fut E]		{\spl {\prev e}{A} {\pit c} l r }										{\splitonesub {} {\fut A}} 		\and
\infersplitone [\fut I]		{\spl {\next e}{\fut A}{\tup{\tup{},p}}{l.r}}							{\splittwosub {} A} 			\and
%\infersplittwo [hold]		{\spl {\pause e}{\rmint}{c,\tup{a,l}.\tup{r;a}}}						{\splitonesub {} \rmint}		\and
\infersplitone				{\spl {\pure e} {\curr A} {\tup{e,\tup{}}}{\_.\tup{}}}					{\cdot}							\and
\infersplitone				{\splitonetall {\letp x{e_1}{e_2}} {?} 
							{\left(\talllet {\tup{x,z_1}} {c_1} {
							 \talllet {\tup{y_2,z_2}} {c_2} {\tup{y_2,\tup{z_1,z_2}}\ttrpar\ttrpar}}\right)}
							 {\tup{l_1,l_2}.\letin{\_}{r_1}{r_2}}}									{\sub 1 ? & \sub 2 ?}			\and
\infersplitone				{\spl {\lifttag e} ? {c}{l.r}}											{\sub {} ?}				
\end{mathpar}
\end{abstrsyn}
\caption{Splitting rules.}
\label{fig:termSplit}
\end{figure*}

