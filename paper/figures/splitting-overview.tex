%!TEX root = ../paper.tex

\begin{figure}
\begin{abstrsyn}

\textbf{Monostage Evaluation (also used for \bbone-Evaluation at \bbonep):}

\hspace{2em} Evaluation Form: $\reduce e v$, where 
	
	\hspace{4em} $e$ is the monostage term to be evaluated
	
	\hspace{4em} $v$ is the resulting value

\textbf{\bbone-Evaluation at \bbonem:}

\hspace{2em} Evaluation Form (Evaluation): $\diaone e {\xi;v}$, where 
	
	\hspace{4em} $e$ is the term at world \bbonem\ to be evaluated

	\hspace{4em} $\xi$ is the resulting residual table
	
	\hspace{4em} $v$ is the resulting partial value

\textbf{\bbone-Evaluation at \bbtwo:}

\hspace{2em} Evaluation Form (Residualization): $\diatwo e q$, where 
	
	\hspace{4em} $e$ is the term at world \bbtwo\ to be evaluated

	\hspace{4em} $q$ is the resulting residual

\hspace{2em} Auxiliary Judgement (Reification): $\reify \xi q q'$, where 
	
	\hspace{4em} $\xi$ is the residual table to be reified into \texttt{let} terms

	\hspace{4em} $q$ is a residual to be placed at the bottom of the \texttt{let}s

	\hspace{4em} $q'$ is the resulting residual

\end{abstrsyn}
\caption{Summary of \lang\ evaluation.}
\label{fig:dynamicsSummary}
\end{figure}

\begin{figure*}
\begin{abstrsyn}

\textbf{Syntactically Seperated Term with Stage \bbtwo\ Output:}

\hspace{2em} Construction: $\pipeS p l r$, where 
	
	\hspace{4em} $p$ is the {\em precomputation}, a monostage term representing the stage \bbone\ part of the program
	
	\hspace{4em} $l.r$ is the {\em resumer}, a monostage term representing the stage \bbtwo\ part of the program

\hspace{2em} Evaluation Form: $\sepredtwo {\pipeS p l r} q$, where 
	
	\hspace{4em} $\pipeS p l r$ is the syntactically seperated term to be evaluated 
	
	\hspace{4em} $q$ is the resulting residual, a monostage term representing remaining stage \bbtwo\ work

\hspace{2em} Evaluation Rule: $\sepredtwo {\pipeS p l r} {[b/l]r}$, where $b$ (called the {\em boundary value}) is generated by $\reduce p b$

\textbf{Syntactically Seperated Term with Multistage Output:}

\hspace{2em} Construction: $\pipeM c l r$, where 
	
	\hspace{4em} $c$ is the {\em combined result}, a monostage term representing the stage \bbone\ part of the program
	
	\hspace{4em} $l.r$ is the {\em resumer}, a monostage term representing the stage \bbtwo\ part of the program

\hspace{2em} Evaluation Form: $\sepredone {\pipeM c l r} {\mval i q}$, where 
	
	\hspace{4em} $\pipeM c l r$ is the syntactically seperated term to be evaluated
	
	\hspace{4em} $\mval i q$ is the resulting masked value (defined below)

\hspace{2em} Evaluation Rule: $\sepredone {\pipeM c l r} {\mval i {[b/l]r}}$, where $b$ (also called the {\em boundary value}) is generated by $\reduce c {\tup{i,b}}$

\textbf{Masked Values:}

\hspace{2em} Construction: $\mval i q$, where 
	
	\hspace{4em} $i$ is the {\em immediate result}, a monostage value representing the stage \bbone\ result
	
	\hspace{4em} $q$ is the {\em residual}, a monostage term representing stage \bbtwo\ work left to do

\end{abstrsyn}
\caption{Overview of the output terms of splitting.}
\label{fig:outputTermSummary}
\end{figure*}

\setlength{\unitlength}{2.8pt}
\begin{figure*}
\begin{abstrsyn}
\centering
\begin{tabular}{c|c}

{\Large \bf Splitting at World \bbonem} & 
{\Large \bf Splitting at World \bbtwo} \\ \hline

\begin{minipage}[t]{0.45\textwidth}
Splitting Terms: $(\colmix e A) \splitonesym \pipeM p l r$, where
\par \hspace{2em} $\colmix e A$ is the \lang\ input term to be split 
\par \hspace{2em} $\pipeM p l r$ is the syntactically seperated result
\\
Masking Partial Values: $[\xi;v] \vsplito \mval i q$, where
\par \hspace{2em} $[\xi;v]$ is a partial value in \lang, resulting from $\redonesym$
\par \hspace{2em} $\mval i q$ is the resulting masked value
\end{minipage}
&

\begin{minipage}[t]{0.45\textwidth}
Splitting Terms: $(\coltwo e A) \splittwosym \pipeS p l r$, where 	
\par \hspace{2em} $\coltwo e A$ is the \lang\ input term to be split
\par \hspace{2em} $\pipeS p l r$ is the syntactically seperated result
\end{minipage}

\\ 

\begin{picture} (80,54) (10,30)

\thicklines
\put(25,37){\oval(22,10)}
\put(25,75){\oval(22,10)}
\put(75,37){\oval(22,10)}
\put(75,75){\oval(22,10)}
\put(36,37){\vector(1,0){28}}
\put(36,75){\vector(1,0){28}}
\put(25,70){\vector(0,-1){28}}
\put(75,70){\vector(0,-1){28}}

\put(14,75){\raisebox{-0.5ex}{\makebox[22 \unitlength]{$\colmix e A$}}}
\put(14,37){\raisebox{-0.5ex}{\makebox[22 \unitlength]{$[\xi,v]$}}}
\put(64,75){\raisebox{-0.5ex}{\makebox[22 \unitlength]{$\pipeM c l r$}}}
\put(64,37){\raisebox{-0.5ex}{\makebox[22 \unitlength]{$\mval i q$}}}

\put(25,78){\makebox[50 \unitlength]{Splitting $\left(\splitonesym\right)$}}
\put(25,32){\makebox[50 \unitlength]{Masking $\left(\vsplito\right)$}}
\put(76,55){\parbox[l]{20 \unitlength}{Separated-Form \\ Evaluation $\left(\sepredonesym\right)$}}
\put(9,55){\parbox[r]{20 \unitlength}{Interleaved \\ Evaluation $\left(\redonesym\right)$}}

\put(28,66){\parbox[t]{44 \unitlength}{ 
	\textbf{Correctness Condition:} \\ 
	Splitting followed by evaluation (top and right arrows)
	produce the same result as 
	evaluation followed by masking (left and bottom arrows),
	up to a term equivalence.
}}
\end{picture}

&
\begin{picture} (80,54) (10,30)

\thicklines
\put(25,75){\oval(22,10)}
\put(75,37){\oval(22,10)}
\put(75,75){\oval(22,10)}
\put(25,37){\vector(1,0){39}}
\put(36,75){\vector(1,0){28}}
\put(25,70){\line(0,-1){33}}
\put(75,70){\vector(0,-1){28}}

\put(14,75){\raisebox{-0.5ex}{\makebox[22 \unitlength]{$\coltwo e A$}}}
\put(64,75){\raisebox{-0.5ex}{\makebox[22 \unitlength]{$\pipeS p l r$}}}
\put(64,37){\raisebox{-0.5ex}{\makebox[22 \unitlength]{$q$}}}

\put(25,78){\makebox[50 \unitlength]{Splitting $\left(\splittwosym\right)$}}
\put(76,55){\parbox[l]{20 \unitlength}{Separated-Form \\ Evaluation $\left(\sepredtwosym\right)$}}
\put(9,55){\parbox[r]{20 \unitlength}{Interleaved \\ Evaluation $\left(\redtwosym\right)$}}

\put(28,66){\parbox[t]{44 \unitlength}{ 
	\textbf{Correctness Condition:} \\ 
	Splitting followed by evaluation (top and right arrows)
	produce the same result as 
	residualization (left and bottom arrow),
	up to a term equivalence.
}}
\end{picture}

\\ 

\end{tabular}


\end{abstrsyn}
\caption{Overview of Splitting.}
\label{fig:splittingSummary}
\end{figure*}
