%!TEX root = ../paper.tex

\begin{figure}[t]
\begin{abstrsyn}
% \begin{mathpar}
% \fbox{(BS) Evaluation of \bbonem}	\and
% \inferdiaone[\rmunit]
% {\red {\tup{}}{\cdot}{\tup{}}}
% {\cdot}
% \and
% \inferdiaone [\to I]
% {\red {\lam{x}{e}} {\cdot}{\lam{x}{e}}}
% {\cdot}
% \and
% \inferdiaone [fix]
% {\red {\fix fxe} {\cdot}{\lam{x}{[\fix fxe / f]e}}}
% {\cdot}
% \and
% \inferdiaone [\to E]
% {\red {\app {e_1}{e_2}} {\gcomp 1 2, \xi'}{v'}}
% {\red {e_1} {\xi_1}{\lam{x}{e'}} & \sub [2] & \red  [\Gamma,\dom{\xi_1},\dom{\xi_2}] {[v_2/x]e'}{\xi'}{v'}}
% \and
% %
% \inferdiaone [\times I]
% {\red {\tup{e_1,e_2}}{\gcomp 1 2}{\tup{v_1,v_2}}}
% {\sub [1] & \sub [2]}
% \and
% \inferdiaone [\times E_1]
% {\red {\pio{e}}{\xi}{v_1}}
% {\red{e}{\xi}{\tup{v_1,v_2}}}
% \and
% \inferdiaone [\times E_2]
% {\red {\pit{e}}{\xi}{v_2}}
% {\red{e}{\xi}{\tup{v_1,v_2}}}
% \and
% \inferdiaone [+ I_1]
% {\red {\inl{e}} {\xi}{\inl{v}}}
% {\sub}
% \and
% \inferdiaone [+ I_2]
% {\red {\inr{e}} {\xi}{\inr{v}}}
% {\sub}
% \and
% %
% \inferdiaone [+ E_1]
% {\red {\caseof{e_1}{x_2.e_2}{x_3.e_3}}{\gcomp 1 2}{v_2}}
% {\red {e_1}{\xi_1}{\inl{v}} & \red
%   [\Gamma,\dom{\xi_1}]{[v/x_2]e_2}{\xi_2}{v_2}}
% \and
% \inferdiaone [+ E_2]
% {\red {\caseof{e_1}{x_2.e_2}{x_3.e_3}}{\gcomp 1 3}{v_3}}
% {\red {e_1}{\xi_1}{\inr{v}} & \red
%   [\Gamma,\dom{\xi_1}]{[v/x_3]e_3}{\xi_3}{v_3}}
% \and
% \inferdiaone[\mu I]
% {\red {\roll{e}}{\xi}{\roll{v}}}
% {\sub}
% \and
% \inferdiaone[\mu E]
% {\red {\unroll{e}}{\xi}{ v}}
% {\red {e}{\xi}{ \roll{v}}}
% \end{mathpar}

% \hrule
% \begin{mathpar}
% \fbox{(BS) Evaluation of \bbtwo}
% \and
% \inferdiaspc[\rmunit]
% {\red {\tup{}}{\tup{}}}
% {\cdot}
% \and
% %\inferdiaspc[int]
% %{\red {i}{i}}
% %{\cdot}
% %\and
% %% %\inferdiaspc [bool]{\red {b}{b}}
% %% {\cdot}
% %% \and
% \inferdiaspc[hyp]
% {\red {x}{x}}
% {\cdot}
% \and
% \inferdiaspc[\to I]
% {\red {\lam{x}{e}}{\lam{x}{q}}}
% {\diatwo [\Gamma,x] e q} 
% \and
% \inferdiaspc[fix]
% {\red {\fix fxe}{\fix fxq}}
% {\diatwo [\Gamma,f,x] e q} 
% \and
% \inferdiaspc [\to E]
% {\red {\app {e_1} {e_2}}{q_1~q_2}}
% {\sub [1] & \sub [2]}
% \and
% \inferdiaspc [\times I]
% {\red {\tup{e_1,e_2}}{\tup{q_1,q_2}}}
% {\sub [1] & \sub [2]} 
% \and
% \inferdiaspc [C]
% {\red {\scriptCapp e}{\scriptCapp q}}
% {\sub & \scriptC \in \{\mathtt{pi1},\mathtt{pi2},\mathtt{inl},\mathtt{inr},\mathtt{roll},\mathtt{unroll}\}}
% %\inferdiaspc[+ I_2]
% %{\red {\inr~e}{\inr~q}}
% %{\sub}
% \and
% \inferdiaspc[+ E_1]
% {\red {\caseof{e_1}{x_2.e_2}{x_3.e_3}}
% {\caseof{q_1}{x_2.q_2}{x_3.q_3}}}
% {\sub [1] & \diatwo [\Gamma,x_2] {e_2} {q_2} & \diatwo [\Gamma,x_3] {e_3} {q_3}} 
% %\inferdiaspc [\mu E]   		{\red {\unroll~e}{\unroll~v}}
% %	{\sub}										\and
% %\inferdiaspc [let]			{\red {\letin{x}{e_1}{e_2}}{\letin{x}{q_1}{q_2}}}			{\sub [1] & \diatwo [\Gamma,x] {e_2} {q_2}} 					\and
% %\inferdiaspc [if_T] 			{\red {\ifthen{e_1}{e_2}{e_3}}{\ifthen{q_1}{q_2}{q_3}}}	{\sub [1] & \sub [2] & \sub [3]} 		\and
% %
% \end{mathpar}
% \hrule
% \begin{mathpar}
% \fbox{(BS) Staging features} \and
% \inferdiaone [\fut I]	{\red {\next{e}}{\hat y \mapsto q}{\next{\hat y}}}			{\diatwo e q}														\and
% \inferdiaspc [\fut E]	{\red {\prev{e}} q}											{\diaone e {\xi}{ \next{\hat y}} & \reify{\xi}{\hat y}q}				\and
% %\inferdiaone [hold]	{\red {\pause e} {\xi, \hat y \mapsto i}{ \next {\hat y}}}	{\red e {\xi}{ \pure i}}												\and
% \infer					{\reify {\cdot}{q}{q}}										{\cdot}																\and
% \infer					{\reify {y \mapsto q_1, \xi}{q_2}{\letin{y}{q_1}{q'}}}		{\reify{\xi}{q_2}{q'}}												\and
% \inferdiaone			{\red {\pure e} {\cdot}{ \pure v}}							{\reduce e v} 														\and
% \inferdiaone			{\red {\letp x {e_1} {e_2}} {\xi_1, \xi_2}{ v_2}}			{\red {e_1} {\xi_1}{\pure {v_1}} & \red {[v_1/x]e_2} {\xi_2}{v_2}} 	\and
% %\inferdiaone			{\red {\lifttag e} {\xi}{\inl{\pure v}}}						{\red e {\xi}{ \pure{\inl v}}}										\and
% %\inferdiaone			{\red {\lifttag e} {\xi}{\inr{\pure v}}}						{\red e {\xi}{ \pure{\inr v}}}										
% \inferdiaone [+ E_1]	{\red {\caseP{e_1}{x_2.e_2}{x_3.e_3}}{\gcomp 1 2}{v_2}}		{\red {e_1}{\xi_1}{\pure{\inl{v}}} 
% 																					&\red [\Gamma,\dom{\xi_1}]{[\pure v/x_2]e_2}{\xi_2}{v_2}}			\and
% \inferdiaone [+ E_2]	{\red {\caseP{e_1}{x_2.e_2}{x_3.e_3}}{\gcomp 1 3}{v_3}}		{\red {e_1}{\xi_1}{\pure{\inr{v}}}
% 																					&\red [\Gamma,\dom{\xi_1}]{[\pure v/x_3]e_3}{\xi_3}{v_3}}		
% \end{mathpar}
% \hrule

\begin{tabular}[t]{| l | l | c |} \hline
\multicolumn{3}{|c|} {Shallow Reductions, $e \betastepsym w e'$} \\ \hline 
$e$ &$e'$& $w$ \\ \hline 
$\tup{\exv {v_1},\exv {v_2}}$ 						& $\exv{\tup{v_1,v_2}}$ 					& all \\
$\pio {\exv{\tup{v_1,v_2}}}$ 						& $\exv{v_1}$ 							& $\bbonep,\hspace{-0.1em}\bbonem$ \\
$\pit {\exv{\tup{v_1,v_2}}}$ 						& $\exv{v_2}$ 							& $\bbonep,\hspace{-0.1em}\bbonem$ \\
$\pio{\exv v}$ 										& $\exv{\pio v}$ 						& $\bbtwo$ \\
$\pit{\exv v}$ 										& $\exv{\pit v}$ 						& $\bbtwo$ \\
$\app {\exv{\fix fxe}}{\exv v}$ 					& $[\fix {\!f\!}xe,v/f\!,x]e$ 			& $\bbonep,\hspace{-0.1em}\bbonem$ \\
$\app{\exv {v_1}}{\exv {v_2}}$ 						& $\exv{\app{v_1}{v_2}}$ 				& $\bbtwo$ \\
$\inl{\exv v}$ 										& $\exv{\inl v}$ 						& all \\
$\inr{\exv v}$ 										& $\exv{\inr v}$ 						& all \\
$\caseof {\exv{\inl v}}{x_2.e_2}\cdot$\hspace{-1em}	& $[v/x_2]e_2$ 							& $\bbonep,\hspace{-0.1em}\bbonem$ \\
$\caseof {\exv{\inr v}}\cdot{x_3.e_3}$\hspace{-1em}	& $[v/x_3]e_3$ 							& $\bbonep,\hspace{-0.1em}\bbonem$ \\
$\roll{\exv v}$ 									& $\exv{\roll v}$ 						& all \\
$\unroll {\exv {\roll v}}$ 							& $\exv{v}$ 							& $\bbonep,\hspace{-0.1em}\bbonem$ \\
$\unroll{\exv v}$ 									& $\exv{\unroll v}$ 					& $\bbtwo$ \\
$\caseof {\exv{e_1}}{x_2.\exv{e_2}}{x_3.\exv{e_3}}$ & $\exv{\caseof{e_1}{x_2.e_2}{x_3.e_3}}$ & $\bbtwo$ \\
$\next{\exv y}$ 									& $\exv{\next y}$ 						& $\bbonem$ \\
$\prev {\exv {\next y}}$ 							& $\exv y$ 								& $\bbtwo$ \\
$\pure{\exv v}$ 									& $\exv{\pure v}$ 						& $\bbonem$ \\
$\letp x {\exv {\pure v}} e$ 						& $[v/x]e$ 								& $\bbonem$ \\
$\caseP {\exv{\pure{\inl v}}}{x_2.e_2}{\cdot}$ 		& $[\pure v/x_2]e_2$ 					& $\bbonem$ \\
$\caseP {\exv{\pure{\inr v}}}{\cdot}{x_3.e_3}$ 		& $[\pure v/x_3]e_3$					& $\bbonem$ \\
\hline
\end{tabular}
\begin{tabular}[t]{|l|c|} \hline
\multicolumn{2}{|c|} {Shallow Contexts, $\mathcal{S} \evalcont w$} \\ \hline
\centering{$\scont \dash$} & $w$ \\ \hline 
$\tup {\dash ,e}$ 										& all \\
$\tup {\exv v,\dash }$ 									& all \\
$\pio \dash$ 											& all \\
$\pit \dash$ 											& all \\
$\fix fx \dash$ 										& $\bbtwo$ \\
$\app \dash e$ 											& all \\
$\app {\exv v} \dash $ 									& all \\
$\inl \dash $ 											& all \\
$\inr \dash $ 											& all \\
$\roll \dash $ 											& all \\
$\unroll \dash $ 										& all \\
$\caseof \dash {x_2.e_2}{x_3.e_3}$ 						& all \\
$\caseof {\exv {v_1}}{x_2.\dash}{x_3.e_3}$				& $\bbtwo$ \\
$\caseof {\exv {v_1}}{x_2.\exv {v_2}}{x_3.\dash}$		& $\bbtwo$ \\
$\caseP \dash {x_2.e_2}{x_3.e_3}$ 						& $\bbonem$ \\
$\letp x \dash e$ 										& $\bbonem$ \\
\hline
\end{tabular}

% \begin{mathpar}
% %\fbox{Reduction Rules}	\and
% \inferstepone	{\red {\pio {\exv{\tup{v_1,v_2}}}} {\exv{v_1}}} 										{} \and
% \inferstepone	{\red {\pit {\exv{\tup{v_1,v_2}}}} {\exv{v_2}}} 										{} \and
% \inferstepone	{\red {\app {\exv{\fix fxe}}{\exv v}} {[\fix fxe,v/f,x]e}} 								{} \and
% \inferstepw		{\stepmix {\letp x {\exv {\pure v}} e} {[v/x]e}} 										{\cdot} \and 
% \infersteppure	{\red {\caseof {\exv{\inl v}}{x_2.e_2}{x_3.e_3}} {[v/x_2]e_2}} 							{\cdot} \and
% \infersteppure	{\red {\caseof {\exv{\inr v}}{x_2.e_2}{x_3.e_3}} {[v/x_3]e_3}} 							{\cdot} \and
% \inferstepw		{\steptwo {\prev {\exv {\next y}}} {\exv y}} 											{\cdot} \and
% \hspace{-0.05in}
% \inferstepw		{\stepmix {\caseP {\exv{\pure {\inl v}}}{x_2.e_2}{x_3.e_3}} {[\pure v/x_2]e_2}} 		{\cdot} \and
% \hspace{-0.05in}
% \inferstepw		{\stepmix {\caseP {\exv{\pure {\inr v}}}{x_2.e_2}{x_3.e_3}} {[\pure v/x_3]e_3}} 		{\cdot} \and
% \end{mathpar}
% \hrule
% \begin{mathpar}
% %\fbox{Value Marking Rules}	\and
% \inferstepw 	{\red {\tup{\exv {v_1},\exv {v_2}}} {\exv{\tup{v_1,v_2}}}} 								{\cdot} \and
% \inferstepGT 	{\red {\inl{\exv v}} {\exv{\inl v}}} 													{} \and
% \inferstepGT 	{\red {\inr{\exv v}} {\exv{\inr v}}} 													{} \and
% \infersteptwo 	{\red {\app{\exv {v_1}}{\exv {v_2}}} {\exv{\app{v_1}{v_2}}}} 							{\cdot} \and
% \infersteptwo 	{\red 	{\caseof {\exv{e_1}}{x_2.\exv{e_2}}{x_3.\exv{e_3}}}
% 						{\exv{\caseof {e_1}{x_2.e_2}{x_3.e_3}}}} 										{\cdot} \and
% \inferstepw 	{\stepmix {\pure{\exv v}} {\exv{\pure v}}} 												{\cdot} \and
% \inferstepw 	{\stepmix {\next{\exv y}} {\exv{\next y}}} 												{\cdot} \and
% \end{mathpar}
\begin{mathpar}
%\fbox{Compatibility Rules}	\and
% \inferstepw		{\red 	{\scont e}
% 						{\scont {e'}}}
% 				{\sub {} &
% 				\scont \dash  \in \{
% 				\pio \dash ,
% 				\pit \dash ,
% 				\tup {\dash ,e},
% 				\tup {\exv v,\dash },
% 				\app \dash e,
% 				\app {\exv v} \dash \}
% 				} \and
% \inferstepGT	{\red 	{\scont e} {\scont {e'}}} 											
% 				{\sub {}  &
% 				\scont \dash  \in \{
% 				\inl \dash ,
% 				\inr \dash ,
% 				\caseof \dash  {x_2.e_2} {x_3.e_3}\}} \and
% \inferstepw		{\stepmix 	{\scont e} {\scont {e'}}} 											
% 				{\stepmix e {e'}  &
% 				\scont \dash  \in \{
% 				\letp x \dash e,
% 				\caseP \dash {x_2.e_2}{x_3.e_3}
% 				\}} \and
% \infersteptwo	{\red 	{\scont e} {\scont {e'}}} 											
% 				{\sub {}  &
% 				\scont \dash  \in \{
% 				\fix fx \dash,
% 				\caseof {\exv {v_1}} {x_2.\dash} {x_3.e_3},
% 				\caseof {\exv {v_1}} {x_2.\exv {v_2}} {x_3.\dash}
% 				\}} \and
% \inferstepw		{\red 	{\pio e}
% 						{\pio {e'}}}
% 				{\sub {}} \and
% \inferstepw		{\red 	{\pit e} 
% 						{\pit {e'}}} 											
% 				{\sub {}} \and
% \inferstepw		{\red 	{\tup {e_1,e_2}} 
% 						{\tup {e'_1,e_2}}} 							
% 				{\sub {1}} \and
% \inferstepw		{\red 	{\tup {\exv{v_1},e_2 }} 
% 						{\tup {\exv{v_1},e'_2}}} 								
% 				{\sub {2}} \and
% \inferstepw		{\red 	{\app {e_1}{e_2}} 
% 						{\app {e'_1}{e_2}}} 							
% 				{\sub {1}} \and
% \inferstepw		{\red 	{\app {\exv{v_1}}{e_2 }} 
% 						{\app {\exv{v_1}}{e'_2}}} 				
% 				{\sub {2}} \and
% \inferstepGT	{\red 	{\inl e} 
% 						{\inl {e'}}} 											
% 				{\sub {}} \and
% \inferstepGT	{\red 	{\inr e} 
% 						{\inr {e'}}} 											
% 				{\sub {}} \and
% \inferstepw		{\red	{\caseof {e_1 }{x_2.e_2}{x_3.e_3}} 
% 						{\caseof {e'_1}{x_2.e_2}{x_3.e_3}}} 					
% 				{\sub {1}} \and
% \infersteptwo	{\red	{\caseof {\exv{e_1}}{x_2.e_2 }{x_3.e_3}} 
% 						{\caseof {\exv{e_1}}{x_2.e'_2}{x_3.e_3}}} 
% 				{\sub {2}} \and
% \infersteptwo	{\red	{\caseof {\exv{e_1}}{x_2.\exv{e_2}}{x_3.e_3}} 
% 						{\caseof {\exv{e_1}}{x_2.\exv{e_2}}{x_3.e'_3}}} 
% 				{\sub {3}} \and
% \infersteptwo	{\red	{\fix fxe} 
% 						{\fix fx{e'}}}
% 				{\sub {}} \and
% \inferstepw		{\stepmix	{\letp x {e_1} {e_2}}
% 							{\letp x {e_1} {e_2}}}
% 				{\stepmix {e_1} {e'_1}} \and
% \inferstepw		{\stepmix	{\caseP {e_1 }{x_2.e_2}{x_3.e_3}} 
% 						{\caseP {e'_1}{x_2.e_2}{x_3.e_3}}} 					
% 				{\stepmix {e_1} {e'_1}} \and
\inferstepw		{\red e e'}
				{e \betastepsym w e'} \and \hspace{-0.35cm}
\inferstepw		{\red 	{\scont e}
						{\scont {e'}}}
				{\sub {} & {\mathcal S} \evalcont w} \and \hspace{-0.35cm}
\inferstepw		{\stepmix	{\pure {e}} 
							{\pure {e'}}} 					
				{\steppure e {e'}} \and \hspace{-0.35cm}
\inferstepw		{\stepmix	{\next {e}} 
							{\next {e'}}} 					
				{\steptwo e {e'}} \and \hspace{-0.35cm}
\inferstepw		{\steptwo	{\prev {e}} 
							{\prev {e'}}} 					
				{\stepmix e {e'}} \\
\inferlift 		{\red {\next {\exv q}} {\next {\exv y}}} {q \text{~not a variable}} \and
\infersteptwo 	{\red {\prev e} {\letin q y {\prev {e'}}}} {\liftsub{}} \and
\inferlift		{\red 	{\scont e} 
						{\scont {e'}}} 											
				{\sub {} &
				{\mathcal S} \evalcont \bbonem
				}
% \inferlift		{\red 	{\pio e} 
% 						{\pio {e'}}} 											
% 				{\sub {}} \and
% \inferlift		{\red 	{\pit e} 
% 						{\pit {e'}}}
% 				{\sub {}} \and
% \inferlift		{\red 	{\tup {e_1,e_2}}
% 						{\tup {e'_1,e_2}}}
% 				{\sub {1}} \and
% \inferlift		{\red 	{\tup {\exv{v_1},e_2 }}
% 						{\tup {\exv{v_1},e'_2}}}
% 				{\sub {2}} \and
% \inferlift		{\red 	{\app {e_1}{e_2}} 
% 						{\app {e'_1}{e_2}}} 							
% 				{\sub {1}} \and
% \inferlift		{\red 	{\app {\exv{v_1}}{e_2 }}
% 						{\app {\exv{v_1}}{e'_2}}}
% 				{\sub {2}} \and
% \inferlift		{\red	{\letp x {e_1} {e_2}}
% 						{\letp x {e'_1} {e_2}}}
% 				{\sub {1}} \and
% \inferlift		{\red	{\caseP {e_1 }{x_2.e_2}{x_3.e_3}} 
% 						{\caseP {e'_1}{x_2.e_2}{x_3.e_3}}} 
% 				{\sub {1}} \and
\end{mathpar}

\end{abstrsyn}
\caption{First pass evaluation of \lang\ dynamics.  
%The helper judgements $e \betastepsym w e'$ and $\mathcal{S} \evalcont w$ refer to shallow reduction and contexts.
}
\label{fig:diaSemantics}
\end{figure}


