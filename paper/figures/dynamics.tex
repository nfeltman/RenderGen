%!TEX root = ../paper.tex

\begin{figure*}
\begin{abstrsyn}
\begin{mathpar}
\fbox {Values} \and
\infertypeswor[\rmunit]		{() \pval}									{\cdot}			\and
\infertypeswor[int]			{i \pval}									{\cdot}			\and
\infertypeswor[\times]		{(v_1, v_2) \pval}							{v_1 \pval 
																		&v_2 \pval}		\and
\infertypeswor[+_1]			{\inl v \pval}								{v \pval}		\and
\infertypeswor[+_2]			{\inr v \pval}								{v \pval}		\and
\infertypeswor[\to]			{\lam x e \pval}							{\cdot}			\and
\infertypeswor[\fut]		{\next {\hat y} \pval}						{\cdot}			\and
\infertypeswor[]			{\pure {v} \pval}							{v \val}		\and
\infertypeswor[]			{[\cdot;v] \cpval}							{v \pval}		\and
\infertypeswor[]			{[\hat y \mapsto q,\xi;v] \cpval}			{q \res 
																		&[\xi;v] \pval}
\end{mathpar}
\hrule
\begin{mathpar}
\fbox{1-Evaluation}
\and
\inferdiaone[\rmunit]
{\red {()}{\cdot;()}}
{\cdot}
\and
\inferdiaone [\to I]
{\red {\lam{x}{e}} {\cdot;\lam{x}{e}}}
{\cdot}
\and
\inferdiaone [\to E]
{\red {\app {e_1}{e_2}} {\gcomp 1 2, \xi';v'}}
{\red {e_1} {\xi_1;\lam{x}{e'}} & \sub [2] & \red  [\Gamma,\dom{\xi_1},\dom{\xi_2}] {[v_2/x]e'}{\xi';v'}}
\and
%
\inferdiaone [\times I]
{\red {(e_1,e_2)}{\gcomp 1 2;\valprod{v_1}{v_2}}}
{\sub [1] & \sub [2]}
\and
\inferdiaone [\times E_1]
{\red {\pio{e}}{\xi;v_1}}
{\red{e}{\xi;\valprod{v_1}{v_2}}}
\and
\inferdiaone [\times E_2]
{\red {\pit{e}}{\xi;v_2}}
{\red{e}{\xi;\valprod{v_1}{v_2}}}
\and
\inferdiaone [+ I_1]
{\red {\inl{e}} {\xi;\inl{v}}}
{\sub}
\and
\inferdiaone [+ I_2]
{\red {\inr{e}} {\xi;\inr{v}}}
{\sub}
\and
%
\inferdiaone [+ E_1]
{\red {\caseof{e_1}{x_2.e_2}{x_3.e_3}}{\gcomp 1 2;v_2}}
{\red {e_1}{\xi_1;\inl{v}} & \red
  [\Gamma,\dom{\xi_1}]{[v/x_2]e_2}{\xi_2;v_2}}
\and
\inferdiaone [+ E_2]
{\red {\caseof{e_1}{x_2.e_2}{x_3.e_3}}{\gcomp 1 3;v_3}}
{\red {e_1}{\xi_1;\inr{v}} & \red
  [\Gamma,\dom{\xi_1}]{[v/x_3]e_3}{\xi_3;v_3}}
\and
\inferdiaone[\mu I]
{\red {\roll{e}}{\xi;\roll{v}}}
{\sub}
\and
\inferdiaone[\mu E]
{\red {\unroll{e}}{\xi; v}}
{\red {e}{\xi; \roll{v}}}
\end{mathpar}

\hrule
\begin{mathpar}
\fbox{Residualization}
\and
\inferdiaspc[\rmunit]
{\red {()}{()}}
{\cdot}
\and
\inferdiaspc[int]
{\red {i}{i}}
{\cdot}
\and
%% %\inferdiaspc [bool]{\red {b}{b}}
%% {\cdot}
%% \and
\inferdiaspc[hyp]
{\red {x}{x}}
{\cdot}
\and
\inferdiaspc[\to I]
{\red {\lam{x}{A}{e}}{\lam{x}{A}{q}}}
{\diatwo [\Gamma,x] e q} 
\and
\inferdiaspc [\to E]
{\red {e_1~e_2}{q_1~q_2}}
{\sub [1] & \sub [2]}
\and
\inferdiaspc [\times I]
{\red {(e_1,e_2)}{(q_1,q_2)}}
{\sub [1] & \sub [2]} 
\and
\inferdiaspc [C]
{\red {\mathcal{C}(e)}{\mathcal{C}(q)}}
{\sub}
%\inferdiaspc[+ I_2]
%{\red {\inr~e}{\inr~q}}
%{\sub}
\and
\inferdiaspc[+ E_1]
{\red {\caseof{e_1}{x_2.e_2}{x_3.e_3}}
{\caseof{q_1}{x_2.q_2}{x_3.q_3}}}
{\sub [1] & \diatwo [\Gamma,x_2] {e_2} {q_2} & \diatwo [\Gamma,x_3] {e_3} {q_3}} 
%\inferdiaspc [\mu E]   		{\red {\unroll~e}{\unroll~v}}
%	{\sub}										\and
%\inferdiaspc [let]			{\red {\letin{x}{e_1}{e_2}}{\letin{x}{q_1}{q_2}}}			{\sub [1] & \diatwo [\Gamma,x] {e_2} {q_2}} 					\and
%\inferdiaspc [if_T] 			{\red {\ifthen{e_1}{e_2}{e_3}}{\ifthen{q_1}{q_2}{q_3}}}	{\sub [1] & \sub [2] & \sub [3]} 		\and
%
\end{mathpar}
\hrule
\begin{mathpar}
\fbox{Staging Features} \and
\inferdiaone [\fut I]	{\red {\next{e}}{\hat y \mapsto q;\next{\hat y}}}			{\diatwo e q}														\and
\inferdiaspc [\fut E]	{\red {\prev{e}} q}											{\diaone e {\xi; \next{\hat y}} & \reify{\xi}{\hat y}q}				\and
\inferdiaone [hold]		{\red {\pause e} {\xi, \hat y \mapsto i; \next {\hat y}}}	{\red e {\xi; \pure i}}												\and
\infer					{\reify {\cdot}{q}{q}}										{\cdot}																\and
\infer					{\reify {(y \mapsto q_1), \xi}{q_2}{\letin{y}{q_1}{q'}}}	{\reify{\xi}{q_2}{q'}}												\and
\inferdiaone			{\red {\pure e} {\cdot; \pure~v}}							{\reduce e v} 														\and
\inferdiaone			{\red {\letp x {e_1} {e_2}} {\xi_1, \xi_2; v_2}}			{\red {e_1} {\xi_1;\pure {v_1}} & \red {[v_1/x]e_2} {\xi_2;v_2}} 	\and
\inferdiaone			{\red {\lifttag e} {\xi;\inl{\pure v}}}						{\red e {\xi; \pure{\inl v}}}										\and
\inferdiaone			{\red {\lifttag e} {\xi;\inr{\pure v}}}						{\red e {\xi; \pure{\inr v}}}										
\end{mathpar}

\end{abstrsyn}
\caption{\lang~Dynamic Semantics.  In residualization rules, $\mathcal{C}$ can stand for \texttt{pi1}/\texttt{pi2}/\texttt{inl}/\texttt{inr}/\texttt{roll}/\texttt{unroll}.}
\label{fig:diaSemantics}
\end{figure*}
