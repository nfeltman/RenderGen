\begin{figure}
\begin{lstlisting}
1`datatype list = Empty | Cons of int * list
fun partition (p : int, l : list) = ...`

datatype tree = Leaf
              | Branch of int * int * tree * tree

1`fun qs1 (l : list) : tree =
  case l of
    Empty => Leaf
  | Cons ht => 
      let val (left,right,i) = partition ht in
      Branch (i, #1 ht, qs1 left, qs1 right)`

2`fun qs2 (p : tree, k : int) : int = 
  case p of
    Leaf => 0
  | Branch (i,h,p1,p2) => 
      case compare k i of
        LT => qs2 (p1,k)
      | EQ => h
      | GT => qs2 (p2,k-i-1)`
\end{lstlisting}
\caption{Two-pass implementation of quickselect.}
\label{fig:qs-split}
\end{figure}

